<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Garden City Interactive Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    html, body { height:100%; margin:0; }
    #map { height:100vh; }

    .panel { position:absolute; z-index:1000; background:rgba(30,30,30,.9); color:#fff; border-radius:8px; }
    .filters { top:10px; right:10px; padding:8px 10px; font:13px/1.3 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    .filters h4 { margin:.2rem 0 .4rem; font-size:13px; }
    .legend  { bottom:10px; right:10px; padding:6px 8px; font:12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    .filters label { display:block; margin:6px 0 0; cursor:pointer; }
    .leaflet-control.custom-btn { background:#222; color:#fff; border:1px solid #555; border-radius:4px; padding:6px 8px; font:12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    .leaflet-control.custom-btn a { color:#fff; text-decoration:none; display:block; }
    .coords { top:10px; left:10px; padding:6px 8px; }
    .coords code { background:rgba(0,0,0,.12); padding:2px 4px; border-radius:4px; }

    /* Top-center banner that stays during pan/zoom */
    .map-banner {
      position:absolute; top:8px; left:50%; transform:translateX(-50%);
      z-index:1100; pointer-events:none;
    }
    .map-banner img { max-width:320px; width:28vw; height:auto; filter:drop-shadow(0 2px 6px rgba(0,0,0,.5)); }
  </style>
</head>
<body>
  <div id="map" aria-label="Garden City interactive map"></div>

  <!-- Sticks to the middle top -->
  <div class="map-banner">
    <img alt="DeadPoly" src="https://media.discordapp.net/attachments/987368741736181820/1168764966501879838/deadpoly_hor-wht.png?ex=68ff9a72&is=68fe48f2&hm=61ff011c0fdc185843652f45c8b2683e4e5ff7ac05c8231b4c149e53b205642b&=&format=webp&quality=lossless">
  </div>

  <div class="panel filters" id="filterPanel"><h4>Filter</h4></div>
  <div class="panel legend" id="legendPanel"></div>

  <div class="panel coords" id="coordsPanel" title="Click anywhere on the map to copy coordinates">
    Click map → coords: <code id="coordsOut">—</code>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
  /* ==================== CONFIG (EDIT) ==================== */

  /* SURFACE image (1264×1264) */
  const SURFACE_IMAGE_URL =
    'https://media.discordapp.net/attachments/784111934253039687/1403676009345191986/gcmap.png?ex=68ff3fa7&is=68fdee27&hm=07104174ac69f6c0bde50568d8e1081ac2273bf7a7dae2ea0b5e94a1fbfa17ef&=&format=webp&quality=lossless&width=1264&height=1264';

  /* UNDERGROUND image (same pixel size as surface) */
  const UNDERGROUND_IMAGE_URL =
    'https://media.discordapp.net/attachments/1284301962006892607/1432075463765000273/GCMap_ug.png?ex=68ffbbb5&is=68fe6a35&hm=0db17a603e6304ada8d47dffb5f49ff826e78b220d7e2010bf4829976b707917&=&format=webp&quality=lossless'; /* <-- replace when ready */

  /* EXACT pixel size of both images */
  const IMAGE_WIDTH  = 1264;
  const IMAGE_HEIGHT = 1264;

  const START = { x: IMAGE_WIDTH/2, y: IMAGE_HEIGHT/2, zoom: 2 };

  /* Icons per category */
  const categoryIconMap = {
    'Point Of Interest': {
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
      iconSize: [25,41], iconAnchor: [12,41]
    },
    'Car Spawn': {
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
      iconSize: [25,41], iconAnchor: [12,41]
    },
    'Hunting Zones': {
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png',
      iconSize: [25,41], iconAnchor: [12,41]
    },
    'Spoilers': {
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
      iconSize: [25,41], iconAnchor: [12,41]
    },
    'Bunker Layouts': {
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-violet.png',
      iconSize: [25,41], iconAnchor: [12,41]
    }
  };


descHtml:'<a href="https://deadpoly.wiki/Animals#Deer" target="_blank" rel="noopener">Deer</a>, <a href="https://deadpoly.wiki/Animals#Bears" target="_blank" rel="noopener">Bears</a>.'

  /* -------- Markers (SURFACE) -------- */
  const markersSurface = [
    /*Bunkers Spoilers*/
    { name:'Bunker 16', x:572, y:503, category:'Spoilers', desc:'No Key Needed.' },
    { name:'Bunker 15', x:558, y:552, category:'Spoilers', desc:'Keycard Needed.' },
    { name:'Bunker 19', x:588, y:573, category:'Spoilers', desc:'Keycard Needed.' },
    { name:'Bunker 24', x:838, y:506, category:'Spoilers', desc:'No Key Needed.' },
    { name:'Bunker 11', x:586, y:542, category:'Spoilers', desc:'Keycard Needed.' },

    /* Hunting zones*/
    { name:'Hunting Zone (N)', x:744, y:385, category:'Hunting Zones',
      desc: 'Deer, Bears' },
    { name:'Hunting Zone (S)', x:903, y:757, category:'Hunting Zones',
      desc: 'Deer, Bears' },

    /* Car Spawns*/
    { name:'Car Spawn', x:577, y:505, category:'Car Spawn',
      desc: 'Cars' },
    { name:'Car Spawn', x:581, y:505, category:'Car Spawn',
      desc: 'Cars' },
    { name:'Car Spawn', x:576, y:573, category:'Car Spawn',
      desc: 'Cars' },
    { name:'Car Spawn', x:579, y:573, category:'Car Spawn',
      desc: 'Cars' },
    { name:'Car Spawn', x:583, y:573, category:'Car Spawn',
      desc: 'Cars' },

    /* Point of Interests*/
    { name:'Allen Airfield', x:598, y:542, category:'Point Of Interest',
      desc:'Airstrip & hangars.', link:'https://deadpoly.wiki/Allen_Airfield' },
    { name:'Nuke', x:896, y:516, category:'Point Of Interest',
      desc:'This POI has been standing since Day 1 of DeadPoly.', link:'https://deadpoly.wiki/Nuke' },
    { name:'Movie Theater', x:940, y:530, category:'Point Of Interest',
      desc:'One of the most popular building locations.', link:'https://deadpoly.wiki/Movie_Theater' }
  ];

  /* -------- Markers (UNDERGROUND) -------- */
  const markersUnderground = [
    { name:'Bunker 16 Layout', x:572, y:503, category:'Bunker Layouts',
      desc:'Underground floor plan.', link:'https://deadpoly.wiki/Bunker_16' },
    { name:'Bunker 11 Layout', x:586, y:542, category:'Bunker Layouts',
      desc:'Requires keycard.', link:'https://deadpoly.wiki/Bunker_11' },
    { name:'Bunker 16', x:572, y:503, category:'Bunker Layouts', desc:'No Key Needed.' },
    { name:'Bunker 15', x:558, y:552, category:'Bunker Layouts', desc:'Keycard Needed.' },
    { name:'Bunker 19', x:588, y:573, category:'Bunker Layouts', desc:'Keycard Needed.' },
    { name:'Bunker 24', x:838, y:506, category:'Bunker Layouts', desc:'No Key Needed.' },
    { name:'Bunker 11', x:586, y:542, category:'Bunker Layouts', desc:'Keycard Needed.' },
  ];

  /* ==================== END CONFIG ==================== */

  /* Map setup with clamped bounds/zoom */
  const map = L.map('map', {
    crs: L.CRS.Simple,
    minZoom: -6,  /* will be raised to the min that shows whole image */
    maxZoom: 6,
    zoomSnap: 0.25,
    zoomDelta: 0.25,
    zoomControl: true
  });

  const bounds = new L.LatLngBounds(
    map.unproject([0, IMAGE_HEIGHT], 0),
    map.unproject([IMAGE_WIDTH, 0], 0)
  );

  const overlaySurface     = L.imageOverlay(SURFACE_IMAGE_URL, bounds);
  const overlayUnderground = L.imageOverlay(UNDERGROUND_IMAGE_URL, bounds);
  overlaySurface.addTo(map);

  /* Keep users on the image; no panning outside */
  map.setMaxBounds(bounds);
  map.options.maxBoundsViscosity = 1.0;

  /* Fit & lock the minimum zoom so you can’t zoom out past the image */
  map.fitBounds(bounds);
  const startLatLng = map.unproject([START.x, START.y], 0);
  const minZoomToShowAll = map.getBoundsZoom(bounds, true);
  map.options.minZoom = minZoomToShowAll;
  map.setView(startLatLng, Math.max(START.zoom, minZoomToShowAll));
  map.on('zoomend', () => { if (map.getZoom() < minZoomToShowAll) map.setZoom(minZoomToShowAll); });

  L.control.scale({ metric:true, imperial:false }).addTo(map);

  /* Helpers */
  const xyToLatLng = (x,y) => map.unproject([x,y], 0);

  const filterPanel = document.getElementById('filterPanel');
  const legendPanel = document.getElementById('legendPanel');

  let currentMode = 'surface';
  let byCat = {};
  let allMarkers = [];

  function clearMarkers() {
    Object.values(byCat).forEach(g => g.clearLayers());
    byCat = {};
    allMarkers = [];
  }

  function buildFilters(categories) {
    filterPanel.innerHTML =
      `<h4>Filter</h4>
       <label style="margin-bottom:6px;display:block">
         <input type="checkbox" id="toggle-underground"> Underground mode
       </label>`;
    const cb = document.getElementById('toggle-underground');
    cb.checked = (currentMode === 'underground');
    cb.addEventListener('change', e => setMode(e.target.checked ? 'underground' : 'surface'));

    categories.sort().forEach(cat => {
      const id = 'cat-' + cat.replace(/\s+/g,'-');
      const label = document.createElement('label');
      label.innerHTML = `<input type="checkbox" id="${id}" checked> ${cat}`;
      label.querySelector('input').addEventListener('change', e => {
        if (e.target.checked) byCat[cat].addTo(map); else map.removeLayer(byCat[cat]);
      });
      filterPanel.appendChild(label);
    });
  }

  function buildLegend(categories) {
    legendPanel.innerHTML = categories.map(cat => {
      const ico = (categoryIconMap[cat] || {}).iconUrl;
      return `<div>${ico ? `<img src="${ico}" style="width:14px;height:22px;vertical-align:middle;margin-right:6px">` : ''}${cat}</div>`;
    }).join('');
  }

  function renderMarkers(markerData) {
    clearMarkers();
    const categoriesPresent = new Set();

    markerData.forEach(m => {
      categoriesPresent.add(m.category);
      if (!byCat[m.category]) byCat[m.category] = L.layerGroup().addTo(map);

      const html =
        `<b>${m.name || 'Point'}</b>` +
        (m.descHtml ? `<br>${m.descHtml}` : (m.desc ? `<br>${m.desc}` : '')) +
        (m.link ? `<br><a href="${m.link}" target="_blank" rel="noopener">Details »</a>` : '') +
        (m.image ? `<br><img src="${m.image}" style="max-width:200px;max-height:150px;border-radius:4px;margin-top:4px">` : '');

      const latlng = xyToLatLng(m.x, m.y);

      let iconOpts = null;
      if (m.icon) {
        iconOpts = { iconUrl: m.icon, iconSize: m.iconSize || [25,41], iconAnchor: m.iconAnchor || [12,41] };
      } else if (categoryIconMap[m.category]) {
        iconOpts = categoryIconMap[m.category];
      }

      const mk = iconOpts
        ? L.marker(latlng, { icon: L.icon(iconOpts) }).bindPopup(html)
        : L.marker(latlng).bindPopup(html);

      byCat[m.category].addLayer(mk);
      allMarkers.push(mk);
    });

    buildFilters([...categoriesPresent]);
    buildLegend([...categoriesPresent]);
  }

  function setMode(mode) {
    if (mode === currentMode) return;
    currentMode = mode;

    if (mode === 'surface') {
      map.removeLayer(overlayUnderground);
      overlaySurface.addTo(map);
      renderMarkers(markersSurface);
    } else {
      map.removeLayer(overlaySurface);
      overlayUnderground.addTo(map);
      renderMarkers(markersUnderground);
    }

    map.setMaxBounds(bounds);
    const z = Math.max(map.getZoom(), minZoomToShowAll);
    map.setView(startLatLng, z);
  }

  /* Initial render */
  renderMarkers(markersSurface);

  /* Buttons */
  function controlButton(text, title, onClick) {
    return L.Control.extend({
      options: { position: 'topleft' },
      onAdd: function () {
        const div = L.DomUtil.create('div', 'leaflet-control custom-btn');
        const a = L.DomUtil.create('a', '', div);
        a.href = '#'; a.title = title || text; a.textContent = text;
        L.DomEvent.disableClickPropagation(div);
        L.DomEvent.on(a, 'click', e => { L.DomEvent.preventDefault(e); onClick(); });
        return div;
      }
    });
  }
  map.addControl(new (controlButton('Home','Reset view', () => map.setView(startLatLng, Math.max(START.zoom, minZoomToShowAll))))());
  map.addControl(new (controlButton('Fullscreen','Toggle fullscreen', () => {
    const el = document.getElementById('map');
    if (!document.fullscreenElement) el.requestFullscreen?.(); else document.exitFullscreen?.();
  }))());

  /* Click to copy pixel coords */
  const coordsOut = document.getElementById('coordsOut');
  map.on('click', e => {
    const p = map.project(e.latlng, 0);
    const x = Math.round(p.x), y = Math.round(p.y);
    const text = `${x}, ${y}`;
    coordsOut.textContent = text;
    try { navigator.clipboard?.writeText?.(text); } catch {}
    L.popup().setLatLng(e.latlng).setContent(`x,y = <b>${x}, ${y}</b><br>(copied)`).openOn(map);
  });
  </script>
</body>
</html>


